<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives: 2014/8 | Yedeying&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Yedeying's blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Yedeying's blog">
<meta property="og:url" content="http://yedeying999.github.io/archives/2014/08/">
<meta property="og:site_name" content="Yedeying's blog">
<meta property="og:description" content="Yedeying's blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yedeying's blog">
<meta name="twitter:description" content="Yedeying's blog">

  
    <link rel="alternative" href="/atom.xml" title="Yedeying&#39;s blog" type="application/atom+xml">
  
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="overlay"></div>
  <div id="header-outer" class="outer">
    <div id="profile_img">
      <img id="circle_img" src="holder.js/150x150" />
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Yedeying&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-menu">
      <nav id="main-nav">
        <ul>
        
          <li><a href="/"><i class="fa fa-home icon-setting"></i></a></li>
        
          <li><a href="/archives"><i class="fa fa-archive icon-setting"></i></a></li>
        
          <li><a href="/about"><i class="fa fa-user icon-setting"></i></a></li>
        
        
          <li><a href="/atom.xml"><i class="fa fa-rss %> icon-setting"></i></a></li>
        
        </ul>
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-javascript-cross-origin-studying" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/08/27/javascript-cross-origin-studying/" class="article-date">
  <time datetime="2014-08-27T07:49:49.000Z" itemprop="datePublished">8月 27 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/27/javascript-cross-origin-studying/">javascript 跨域学习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>项目地址: <a href="https://github.com/yedeying999/cross-origin-try" target="_blank" rel="external">https://github.com/yedeying999/cross-origin-try</a></p>
<h2 id="1-_Cross_Origin_Resource_Sharing(CORS)_跨域资源共享">1. Cross Origin Resource Sharing(CORS) 跨域资源共享</h2>
<h3 id="兼容性:">兼容性:</h3>
<pre><code><span class="title">IE</span> <span class="number">8</span> +
Firefox <span class="number">15</span>.<span class="number">0</span> +
Chrome <span class="number">22</span>.<span class="number">0</span> +
Safari <span class="number">5</span>.<span class="number">1</span> +
Opera <span class="number">12</span>.<span class="number">0</span> +
IOS Safari <span class="number">3</span>.<span class="number">2</span> +
Android <span class="number">2</span>.<span class="number">1</span> +
Blackberry Browser <span class="number">7</span>.<span class="number">0</span> +
</code></pre><h3 id="实现手段:">实现手段:</h3>
<pre><code>数据端:
    设置Access-Control-Allow-Origin头, 值为<span class="keyword">*</span>或对应要访问的域名
客户端:
    IE8-9使用 XDomainRequest
    其它客户端使用标准AJAX方法
</code></pre><h3 id="评价:">评价:</h3>
<pre><code>数据安全性良好, 支持大量数据, 支持POST, 但兼容性要求相比其它略高
</code></pre><h3 id="示例:">示例:</h3>
<p>客户端 index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"ye"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">      <span class="function"><span class="keyword">function</span> <span class="title">createXHR</span><span class="params">()</span> </span>{</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">window</span>.XDomainRequest) {</div><div class="line">          <span class="keyword">return</span> <span class="keyword">new</span> XDomainRequest();</div><div class="line">        }</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest) {</div><div class="line">          <span class="keyword">return</span> <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">        }</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">window</span>.ActiveXObject) {</div><div class="line">          <span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHTTP'</span>);</div><div class="line">        }</div><div class="line">        <span class="keyword">else</span> {</div><div class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'no xhr'</span>);</div><div class="line">        }</div><div class="line">      }</div><div class="line">      <span class="function"><span class="keyword">function</span> <span class="title">parse</span><span class="params">()</span> </span>{</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">window</span>.JSON) {</div><div class="line">          <span class="keyword">var</span> x = <span class="built_in">JSON</span>.parse(xhr.responseText);</div><div class="line">          <span class="built_in">document</span>.getElementById(<span class="string">'ye'</span>).innerHTML = x.name;</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">          <span class="built_in">document</span>.getElementById(<span class="string">'ye'</span>).innerHTML = xhr.responseText;</div><div class="line">        }</div><div class="line">      }</div><div class="line">      <span class="keyword">var</span> xhr = createXHR();</div><div class="line">      <span class="keyword">var</span> url = <span class="string">'http://localhost:3000'</span>;</div><div class="line">      xhr.open(<span class="string">"post"</span>, url, <span class="literal">true</span>);</div><div class="line">      xhr.onreadystatechange = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">        <span class="keyword">if</span>(xhr.readyState === <span class="number">4</span>) {</div><div class="line">          parse();</div><div class="line">        }</div><div class="line">      }</div><div class="line">      <span class="keyword">if</span>(<span class="built_in">window</span>.XDomainRequest) {</div><div class="line">        xhr.onload = parse;</div><div class="line">      }</div><div class="line">      xhr.send(<span class="string">'data=hehe'</span>);</div><div class="line">    };</div><div class="line">  <span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></div></pre></td></tr></table></figure>

<p>服务端 nodejs</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> router = express.Router();</div><div class="line"></div><div class="line"><span class="comment">/* POST home page. */</span></div><div class="line">router.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{</div><div class="line">  res.header(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'*'</span>);</div><div class="line">  <span class="keyword">var</span> arr = [];</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> req)</div><div class="line">    arr.push(i);</div><div class="line">  arr.sort();</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> arr)</div><div class="line">    <span class="built_in">console</span>.log(arr[i]);</div><div class="line">  <span class="built_in">console</span>.dir(req.param(<span class="string">'data'</span>));</div><div class="line">  <span class="comment">// console.dir(req);</span></div><div class="line">  res.send({</div><div class="line">    name: <span class="string">'yedeying'</span>,</div><div class="line">    age: <span class="number">20</span></div><div class="line">  });</div><div class="line">});</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = router;</div></pre></td></tr></table></figure>

<h2 id="2-_Cross_Document_Messaging_跨文档消息传输">2. Cross Document Messaging 跨文档消息传输</h2>
<h3 id="兼容性:-1">兼容性:</h3>
<pre><code><span class="title">IE</span> <span class="number">8</span> +
Firefox <span class="number">3</span>.<span class="number">0</span> +
Chrome <span class="number">3</span>.<span class="number">0</span> +
Safari <span class="number">4</span>.<span class="number">0</span> +
Opera <span class="number">9</span>.<span class="number">0</span> +
</code></pre><h3 id="实现手段:-1">实现手段:</h3>
<pre><code>HTML5的postMessage和onmessage API, 配合iframe实现
    <span class="number">1</span>. 在要访问数据的页面<span class="literal">A</span>创建iframe, 指向保存数据的页面B
    <span class="number">2</span>. 页面<span class="literal">A</span>通过iframe.contentWindow.postMessage向页面B发送请求及数据, 数据格式可以为JSON或字符串等
    <span class="number">3</span>. 页面B通过onmessage监听页面<span class="literal">A</span>发来的请求, 并通过window.parent.postMessage向页面<span class="literal">A</span>反馈信息
</code></pre><h3 id="评价:-1">评价:</h3>
<pre><code>兼容性相比CORS方式更优
</code></pre><h3 id="样例:">样例:</h3>
<p>客户端 index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">onclick</span>=<span class="value">"handler()"</span>&gt;</span>发信<span class="tag">&lt;/<span class="title">button</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"value"</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">placeholder</span>=<span class="value">"请输入信息"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">iframe</span> <span class="attribute">src</span>=<span class="value">"./frame.html"</span> <span class="attribute">frameborder</span>=<span class="value">"0"</span> <span class="attribute">width</span>=<span class="value">"100%"</span> <span class="attribute">height</span>=<span class="value">"100%"</span>&gt;</span><span class="tag">&lt;/<span class="title">iframe</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> input = <span class="built_in">document</span>.querySelector(<span class="string">'#value'</span>);</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handler</span><span class="params">()</span> </span>{</div><div class="line">      <span class="built_in">document</span>.querySelector(<span class="string">'iframe'</span>).contentWindow.postMessage(input.value, <span class="string">'*'</span>);</div><div class="line">    }</div><div class="line">  <span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></div></pre></td></tr></table></figure>

<p>服务端 frame.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>ye<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="title">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">h1</span>&gt;</span><span class="tag">&lt;/<span class="title">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">        <span class="keyword">var</span> h1 = <span class="built_in">document</span>.querySelector(<span class="string">'h1'</span>);</div><div class="line">        h1.innerHTML = <span class="string">'you have not post any message'</span>;</div><div class="line">        <span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span><span class="params">(e)</span> </span>{</div><div class="line">          h1.innerHTML = e.data;</div><div class="line">        }</div><div class="line">      };</div><div class="line">    <span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="title">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></div></pre></td></tr></table></figure>

<h2 id="3-_使用window-name解决跨域问题">3. 使用window.name解决跨域问题</h2>
<h3 id="兼容性:-2">兼容性:</h3>
<pre><code>几乎所有浏览器都支持
</code></pre><h3 id="实现手段:-2">实现手段:</h3>
<pre><code>一个页面在更改<span class="built_in">document</span>.location前后, 其<span class="built_in">window</span>.name属性不变.
利用此特性:
    <span class="number">1.</span> 用一个iframe指向数据页面A, 将需要传输的数据存到<span class="built_in">window</span>.name里
    <span class="number">2.</span> 将其location指向一个与申请页面B同域名的代理页面C
    <span class="number">3.</span> 在B页面或C页面把<span class="built_in">window</span>.name的内容由页面C传送到页面B
</code></pre><h3 id="评价:-2">评价:</h3>
<pre><code>接近完美, 只是实现手段有点绕
</code></pre><h3 id="样例:-1">样例:</h3>
<p>客户端 index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">onclick</span>=<span class="value">'getInfo()'</span>&gt;</span>获取数据<span class="tag">&lt;/<span class="title">button</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">p</span> <span class="attribute">id</span>=<span class="value">'text'</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span><span class="params">()</span> </span>{</div><div class="line">      <span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>),</div><div class="line">        bl = <span class="literal">true</span>;</div><div class="line">      iframe.style.display = <span class="string">'none'</span>;</div><div class="line">      iframe.onload = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">        <span class="keyword">if</span>(bl) {</div><div class="line">          iframe.contentWindow.location = <span class="string">'./proxy.html?callback=callback'</span>;</div><div class="line">          bl = <span class="literal">false</span>;</div><div class="line">        }</div><div class="line">      }</div><div class="line">      iframe.src = <span class="string">'http://localhost:3000'</span>;</div><div class="line">      <span class="built_in">document</span>.body.appendChild(iframe);</div><div class="line">    }</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callback</span><span class="params">(data)</span> </span>{</div><div class="line">      <span class="built_in">document</span>.getElementById(<span class="string">'text'</span>).innerHTML = data;</div><div class="line">    }</div><div class="line">  <span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></div></pre></td></tr></table></figure>

<p>数据端 data.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Data<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">window</span>.name = <span class="string">'the information I want to send'</span>;</div><div class="line">  <span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></div></pre></td></tr></table></figure>

<p>代理端 proxy.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> callback = location.search.split(<span class="string">'='</span>)[<span class="number">1</span>];</div><div class="line">    <span class="built_in">window</span>.parent[callback](<span class="built_in">window</span>.name);</div><div class="line">  <span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></div></pre></td></tr></table></figure>

<h2 id="4-_jsonp">4. jsonp</h2>
<h3 id="兼容性:-3">兼容性:</h3>
<pre><code>几乎所有浏览器都支持
</code></pre><h3 id="实现手段:-3">实现手段:</h3>
<pre><code>HTML中script的src标签可以跨域申请javascript文本, 属于GET方法, 服务器只要对URL响应返回对应的数据就可以达到目的, 但客户端要求javascript语句, 而json等文本并非javascript语句, 此时将其封装成回调函数即可

客户端:
    中在目标url后加入?<span class="keyword">callback</span>=cb之类的字眼, 其中<span class="keyword">callback</span>及cb都可以自定, <span class="keyword">callback</span>代表服务器端识别的关键字, cb代表客户端中用以回调数据的全局函数
服务端:
    <span class="number">1.</span> 接收到请求时, 通过约定的key获取回调函数的名字cb
    <span class="number">2.</span> 设置响应头的Content-Type: text/javascript
    <span class="number">3.</span> 通过读取对应的json文件, 返回cb(jsonData)这样的格式
</code></pre><h3 id="评价:-3">评价:</h3>
<pre><code>兼容性完美, 但因为请求信息通过url传送, 所以传送数据不能太大, 即使浏览器能容纳也不直观, 适合只传送某些参数的情况, 另外不支持POST
</code></pre><h3 id="样例:-2">样例:</h3>
<p>客户端 html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"ye"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callback</span><span class="params">(data)</span> </span>{</div><div class="line">      <span class="keyword">if</span>(data) {</div><div class="line">        <span class="built_in">document</span>.getElementById(<span class="string">'ye'</span>).innerHTML = data.name + <span class="string">' is at age '</span> + data.age;</div><div class="line">      }</div><div class="line">    }</div><div class="line">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">      <span class="keyword">var</span> scr = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</div><div class="line">      <span class="built_in">document</span>.body.appendChild(scr);</div><div class="line">      scr.src = <span class="string">'http://localhost/ye/jsonp/data.php?callback=callback'</span>;</div><div class="line">    };</div><div class="line">  <span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></div></pre></td></tr></table></figure>

<p>数据端 data.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">&lt;?php</span></div><div class="line">  header(<span class="string">"Content-type:text/Javascript"</span>);</div><div class="line">  <span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">'callback'</span>].<span class="string">'('</span>;</div><div class="line">  <span class="variable">$txt</span> = readfile(<span class="string">'data.json'</span>);</div><div class="line">  <span class="keyword">echo</span> <span class="string">')'</span>;</div><div class="line"><span class="preprocessor">?&gt;</span></div></pre></td></tr></table></figure>

<p>数据 data.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"yedeying"</span></span>,</div><div class="line">  "<span class="attribute">age</span>": <span class="value"><span class="number">18</span></span></div><div class="line">}</div></pre></td></tr></table></figure>

<h2 id="5-_Websocket">5. Websocket</h2>
<h3 id="兼容性:-4">兼容性:</h3>
<pre><code><span class="title">Chrome</span> <span class="number">4</span>+
Firefox <span class="number">4</span>+
Internet Explorer <span class="number">10</span>+
Opera <span class="number">10</span>+
Safari <span class="number">5</span>+
</code></pre><h3 id="实现手段:-4">实现手段:</h3>
<pre><code>HTML5的websocket协议, 至今多数服务端都已支持websocket
</code></pre><h3 id="评价:-4">评价:</h3>
<pre><code>websocket实际上应该是作为全双工连接最标准的实现方式, 因此可以用到跨域问题上, 奈何其兼容性不够好
</code></pre><h3 id="样例:-3">样例:</h3>
<p>客户端 index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="doctype">&lt;!doctype html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>Socket.IO<span class="tag">&lt;/<span class="title">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="title">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="title">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">h2</span> <span class="attribute">id</span>=<span class="value">"p"</span>&gt;</span><span class="tag">&lt;/<span class="title">h2</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"/socket.io/socket.io.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line">      <span class="function"><span class="keyword">function</span> <span class="title">$</span><span class="params">(str)</span> </span>{ <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(str); }</div><div class="line">      <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(str)</span> </span>{ p.innerHTML = str; }</div><div class="line">      <span class="function"><span class="keyword">function</span> <span class="title">callback</span><span class="params">(data)</span> </span>{</div><div class="line">        data = <span class="built_in">JSON</span>.parse(data);</div><div class="line">        show(data.name + <span class="string">' is at age '</span> + data.age);</div><div class="line">      }</div><div class="line">      <span class="keyword">var</span> p = $(<span class="string">'p'</span>), socket = io();</div><div class="line">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">        socket.emit(<span class="string">'getData'</span>);</div><div class="line">      }</div><div class="line">      socket.on(<span class="string">'data'</span>, callback);</div><div class="line">    <span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="title">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></div></pre></td></tr></table></figure>

<p>服务端 nodejs index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>).Server(app);</div><div class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(http);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{</div><div class="line">  res.sendfile(<span class="string">'index.html'</span>);</div><div class="line">});</div><div class="line"></div><div class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span><span class="params">(socket)</span> </span>{</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'a user connected'</span>);</div><div class="line">  socket.on(<span class="string">'getData'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">    fs.readFile(<span class="string">'data.json'</span>, {encoding: <span class="string">'utf8'</span>}, <span class="function"><span class="keyword">function</span><span class="params">(err, data)</span> </span>{</div><div class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> <span class="keyword">new</span> err;</div><div class="line">      socket.emit(<span class="string">'data'</span>, data);</div><div class="line">    });</div><div class="line">  });</div><div class="line">});</div><div class="line"></div><div class="line">http.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'listening on *:3000'</span>);</div><div class="line">});</div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yedeying999.github.io/2014/08/27/javascript-cross-origin-studying/" data-id="hwi2lrlyziqs1qbp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cross-origin/">cross-origin</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-canvas-studying" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/08/20/canvas-studying/" class="article-date">
  <time datetime="2014-08-20T08:48:14.000Z" itemprop="datePublished">8月 20 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/20/canvas-studying/">canvas学习 - 动态绘制五角星</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <iframe id="cp_embed_fbrat" src="//codepen.io/yedeying999/embed/fbrat?height=300&theme-id=javascript&slug-hash=fbrat&default-tab=800" scrolling="no" frameborder="0" height="300" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yedeying999.github.io/2014/08/20/canvas-studying/" data-id="0kminrto5ecxhm7t" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/canvas/">canvas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Yedeying<br>
      <a href="https://github.com/ken8203/hexo-theme-alberta" target="_blank">Alberta</a> by <a href="http://jaychung.tw" target="_blank">jaychung</a>. Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Thank <a href="http://subtlepatterns.com/" target="_blank">Subtlepatterns</a>
    </div>
  </div>
</footer>
    </div>
    
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="//imsky.github.io/holder/holder.js"></script>

  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>